# å¤§ç›˜åˆ†æç•Œé¢

<cite>
**æœ¬æ–‡å¼•ç”¨çš„æ–‡ä»¶**
- [page_market_overview.py](file://ui/components/page_market_overview.py)
- [market_data_tools.py](file://market/market_data_tools.py)
- [market_data_fetcher.py](file://market/market_data_fetcher.py)
- [market_ai_analysis.py](file://market/market_ai_analysis.py)
- [market_formatters.py](file://market/market_formatters.py)
- [market_report.py](file://market/market_report.py)
- [page_export.py](file://ui/components/page_export.py)
- [config.py](file://ui/config.py)
- [test_page_market_overview.py](file://tests/unit/ui/test_page_market_overview.py)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ¶æ„æ€»è§ˆ](#æ¶æ„æ€»è§ˆ)
5. [è¯¦ç»†ç»„ä»¶åˆ†æ](#è¯¦ç»†ç»„ä»¶åˆ†æ)
6. [ä¾èµ–å…³ç³»åˆ†æ](#ä¾èµ–å…³ç³»åˆ†æ)
7. [æ€§èƒ½è€ƒé‡](#æ€§èƒ½è€ƒé‡)
8. [æ•…éšœæ’æŸ¥æŒ‡å—](#æ•…éšœæ’æŸ¥æŒ‡å—)
9. [ç»“è®º](#ç»“è®º)
10. [é™„å½•](#é™„å½•)

## ç®€ä»‹
æœ¬æ–‡ä»¶ä¸ºâ€œå¤§ç›˜åˆ†æç•Œé¢â€çš„APIå‚è€ƒæ–‡æ¡£ï¼Œé¢å‘ä½¿ç”¨è€…ä¸å¼€å‘è€…ï¼Œç³»ç»Ÿæ¢³ç†å¹¶è¯´æ˜é¡µé¢å…¥å£å‡½æ•°ä¸å„åŠŸèƒ½æ¨¡å—çš„èŒè´£ã€å‚æ•°ã€è¿”å›å€¼ä¸ä½¿ç”¨åœºæ™¯ã€‚é‡ç‚¹è¦†ç›–ä»¥ä¸‹å…¬å…±æ¥å£ï¼š
- é¡µé¢å…¥å£ï¼šdisplay_market_overview
- æŒ‡æ•°å±•ç¤ºï¼šdisplay_market_indices
- æŠ€æœ¯åˆ†æï¼šdisplay_market_technical_analysis
- åŸºæœ¬é¢åˆ†æï¼šdisplay_market_fundamentals
- å¸‚åœºæƒ…ç»ªï¼šdisplay_market_sentiment
- å¸‚åœºæ–°é—»ï¼šdisplay_market_news
- ç»¼åˆæ‘˜è¦ä¸è¯„çº§ï¼šdisplay_market_summaryã€display_comprehensive_rating
- AIåˆ†æä¸å¯¼å‡ºï¼šhandle_ai_analysisã€display_ai_analysis_sectionã€display_market_report_exportã€write_market_report

åŒæ—¶ï¼Œæ–‡æ¡£é˜è¿°AIåˆ†æçš„é›†æˆæœºåˆ¶ã€ç”¨æˆ·è§‚ç‚¹è¾“å…¥å¤„ç†ä¸ç»¼åˆè¯„çº§çš„è®¡ç®—é€»è¾‘ï¼Œå¹¶æä¾›è°ƒç”¨æµç¨‹ç¤ºä¾‹ä¸å¯è§†åŒ–å›¾ç¤ºï¼Œå¸®åŠ©è¯»è€…å¿«é€Ÿç†è§£ä¸æ­£ç¡®ä½¿ç”¨ã€‚

## é¡¹ç›®ç»“æ„
å¤§ç›˜åˆ†æç•Œé¢ä½äºUIç»„ä»¶å±‚ï¼Œå›´ç»•Streamlité¡µé¢ç»„ç»‡ï¼Œæ•°æ®æ¥æºé€šè¿‡ç»Ÿä¸€çš„å¸‚åœºå·¥å…·ç±»å°è£…ï¼Œæœ€ç»ˆç”±æ ¼å¼åŒ–å™¨ä¸å¯¼å‡ºç»„ä»¶å®Œæˆå±•ç¤ºä¸è½ç›˜ã€‚

```mermaid
graph TB
subgraph "UIç»„ä»¶å±‚"
A["page_market_overview.py<br/>é¡µé¢å…¥å£ä¸å„åŠŸèƒ½æ¨¡å—"]
B["page_export.py<br/>é€šç”¨å¯¼å‡ºç»„ä»¶"]
end
subgraph "å¸‚åœºæ•°æ®å±‚"
C["market_data_tools.py<br/>ç»Ÿä¸€æ•°æ®å·¥å…·ç±»"]
D["market_data_fetcher.py<br/>æ•°æ®æŠ“å–ä¸ç¼“å­˜"]
E["market_ai_analysis.py<br/>AIåˆ†æç”Ÿæˆ"]
F["market_formatters.py<br/>Markdownæ ¼å¼åŒ–"]
G["market_report.py<br/>æŠ¥å‘Šç”Ÿæˆå…¥å£"]
end
subgraph "é…ç½®ä¸å¸¸é‡"
H["ui/config.py<br/>FOCUS_INDICESç­‰é…ç½®"]
end
A --> C
A --> B
C --> D
C --> E
C --> F
G --> C
G --> F
A --> H
```

å›¾è¡¨æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L627-L758)
- [market_data_tools.py](file://market/market_data_tools.py#L421-L455)
- [market_data_fetcher.py](file://market/market_data_fetcher.py#L286-L355)
- [market_ai_analysis.py](file://market/market_ai_analysis.py#L14-L123)
- [market_formatters.py](file://market/market_formatters.py#L561-L647)
- [market_report.py](file://market/market_report.py#L13-L87)
- [config.py](file://ui/config.py#L45-L82)

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L627-L758)
- [market_data_tools.py](file://market/market_data_tools.py#L421-L455)
- [market_data_fetcher.py](file://market/market_data_fetcher.py#L286-L355)
- [market_ai_analysis.py](file://market/market_ai_analysis.py#L14-L123)
- [market_formatters.py](file://market/market_formatters.py#L561-L647)
- [market_report.py](file://market/market_report.py#L13-L87)
- [config.py](file://ui/config.py#L45-L82)

## æ ¸å¿ƒç»„ä»¶
- é¡µé¢å…¥å£ä¸ç»„ç»‡
  - display_market_overviewï¼šè´Ÿè´£é¡µé¢å¸ƒå±€ã€æ ‡ç­¾é¡µç»„ç»‡ã€ç¼“å­˜æ§åˆ¶ã€AIåˆ†æå¼€å…³ä¸ç”¨æˆ·è§‚ç‚¹è¾“å…¥ã€åˆ·æ–°ä¸åˆ†æè§¦å‘ã€‚
- æŒ‡æ•°ä¸Kçº¿
  - display_market_indicesï¼šå±•ç¤ºå…³æ³¨æŒ‡æ•°çš„å®æ—¶è¡Œæƒ…ã€‚
  - display_market_technical_analysisï¼šå±•ç¤ºKçº¿å›¾ã€æŠ€æœ¯æŒ‡æ ‡ä¸é£é™©åˆ†æã€‚
- åŸºæœ¬é¢
  - display_market_fundamentalsï¼šæ•´åˆä¼°å€¼ã€èµ„é‡‘æµã€èèµ„èåˆ¸ä¸‰ç±»åŸºæœ¬é¢æŒ‡æ ‡ã€‚
  - display_valuation_analysis/display_money_flow_analysis/display_margin_trading_analysisï¼šåˆ†åˆ«å±•ç¤ºä¼°å€¼ã€èµ„é‡‘æµã€èèµ„èåˆ¸ã€‚
- æƒ…ç»ªä¸æ–°é—»
  - display_market_sentimentï¼šå±•ç¤ºç»¼åˆå¸‚åœºæƒ…ç»ªåˆ†æã€‚
  - display_market_sentiment_analysisï¼šè°ƒç”¨æ ¼å¼åŒ–å™¨è¾“å‡ºæƒ…ç»ªMarkdownã€‚
  - display_market_newsï¼šæŒ‰é…ç½®å¼€å…³å±•ç¤ºå¸‚åœºæ–°é—»ã€‚
- ç»¼åˆæ‘˜è¦ä¸è¯„çº§
  - display_market_summaryï¼šç”Ÿæˆç»¼åˆæ‘˜è¦ã€è§¦å‘AIåˆ†æã€æ˜¾ç¤ºç»¼åˆè¯„çº§ä¸å¯¼å‡ºã€‚
  - display_comprehensive_ratingï¼šåŸºäºæŠ€æœ¯é¢ã€èµ„é‡‘é¢ã€æƒ…ç»ªé¢è®¡ç®—ç»¼åˆè¯„çº§ã€‚
- AIåˆ†æä¸å¯¼å‡º
  - handle_ai_analysis/display_ai_analysis_sectionï¼šAIåˆ†æè§¦å‘ä¸å±•ç¤ºã€‚
  - display_market_report_export/write_market_reportï¼šå¯¼å‡ºæŠ¥å‘Šï¼ˆPDF/DOCX/Mardown/HTMLï¼‰ã€‚

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L221-L758)
- [market_data_tools.py](file://market/market_data_tools.py#L379-L495)
- [market_ai_analysis.py](file://market/market_ai_analysis.py#L14-L123)
- [market_report.py](file://market/market_report.py#L13-L87)
- [page_export.py](file://ui/components/page_export.py#L180-L281)

## æ¶æ„æ€»è§ˆ
ä¸‹å›¾å±•ç¤ºä»é¡µé¢å…¥å£åˆ°æ•°æ®è·å–ã€AIåˆ†æä¸å¯¼å‡ºçš„æ•´ä½“æµç¨‹ã€‚

```mermaid
sequenceDiagram
participant U as "ç”¨æˆ·"
participant P as "é¡µé¢(display_market_overview)"
participant T as "MarketTools"
participant F as "Fetcher"
participant A as "AIåˆ†æ"
participant R as "æŠ¥å‘Šç”Ÿæˆ(write_market_report)"
U->>P : é€‰æ‹©æŒ‡æ•°/å‹¾é€‰AI/è¾“å…¥è§‚ç‚¹/ç‚¹å‡»å¼€å§‹åˆ†æ
P->>T : è·å–ç»¼åˆæŠ¥å‘Š(get_comprehensive_market_report)
T->>F : æŠ€æœ¯æŒ‡æ ‡/æƒ…ç»ª/ä¼°å€¼/èµ„é‡‘æµ/èèµ„èåˆ¸/æ–°é—»
F-->>T : è¿”å›æ•°æ®
T-->>P : è¿”å›ç»¼åˆæŠ¥å‘Š
alt AIå¼€å¯
P->>A : ç”ŸæˆAIåˆ†æ(generate_index_analysis_report)
A-->>P : è¿”å›AIæŠ¥å‘Š
end
P->>P : å±•ç¤ºæ‘˜è¦/è¯„çº§/å¯¼å‡º
U->>R : å¯¼å‡ºPDF/DOCX/Mardown/HTML
R->>T : è·å–ç»¼åˆæŠ¥å‘Šä¸AIåˆ†æ
T-->>R : è¿”å›æ•°æ®
R-->>U : ä¸‹è½½æ–‡ä»¶
```

å›¾è¡¨æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L627-L758)
- [market_data_tools.py](file://market/market_data_tools.py#L421-L455)
- [market_ai_analysis.py](file://market/market_ai_analysis.py#L14-L123)
- [market_report.py](file://market/market_report.py#L13-L87)

## è¯¦ç»†ç»„ä»¶åˆ†æ

### é¡µé¢å…¥å£ï¼šdisplay_market_overview
- èŒè´£
  - ç»„ç»‡é¡µé¢å¸ƒå±€ä¸æ ‡ç­¾é¡µï¼›æ§åˆ¶ç¼“å­˜ç­–ç•¥ï¼›å¤„ç†AIåˆ†æå¼€å…³ä¸ç”¨æˆ·è§‚ç‚¹è¾“å…¥ï¼›è§¦å‘åˆ†æä¸åˆ·æ–°ã€‚
- å‚æ•°
  - æ— æ˜¾å¼å‚æ•°ï¼›é€šè¿‡Streamlitæ§ä»¶ä¸session_stateäº¤äº’ã€‚
- è¿”å›å€¼
  - æ— è¿”å›å€¼ï¼›é€šè¿‡Streamlitç»„ä»¶æ¸²æŸ“é¡µé¢ã€‚
- ä½¿ç”¨åœºæ™¯
  - ç”¨æˆ·è¿›å…¥â€œå¤§ç›˜æ•´ä½“åˆ†æâ€é¡µé¢ï¼Œé€‰æ‹©åˆ†ææŒ‡æ•°ã€æ˜¯å¦å¯ç”¨AIã€æ˜¯å¦ä½¿ç”¨ç¼“å­˜ã€è¾“å…¥è§‚ç‚¹ï¼Œç‚¹å‡»â€œå¼€å§‹åˆ†æâ€åç”Ÿæˆå„æ ‡ç­¾é¡µå†…å®¹ã€‚
- å…³é”®æµç¨‹
  - è¯»å–FOCUS_INDICESä½œä¸ºæŒ‡æ•°é€‰æ‹©é¡¹ï¼›æ ¹æ®é…ç½®å†³å®šæ˜¯å¦æ˜¾ç¤ºâ€œå¸‚åœºèµ„è®¯â€æ ‡ç­¾é¡µï¼›æ ¹æ®use_cacheå†³å®šæ˜¯å¦æ¸…ç©ºç¼“å­˜ï¼›æ ¹æ®use_ai_analysiså†³å®šæ˜¯å¦ç”ŸæˆAIåˆ†æï¼›åˆ†æå®Œæˆååœ¨å„æ ‡ç­¾é¡µå†…è°ƒç”¨å¯¹åº”å±•ç¤ºå‡½æ•°ã€‚
- ä¼šè¯çŠ¶æ€
  - market_use_cacheã€run_ai_indexã€market_user_opinionã€current_analysis_indexã€show_analysis_resultsã€ai_index_reportç­‰ã€‚

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L627-L758)
- [config.py](file://ui/config.py#L45-L82)

### æŒ‡æ•°å±•ç¤ºï¼šdisplay_market_indices
- èŒè´£
  - è·å–å½“å‰ä¸»è¦æŒ‡æ•°çš„å®æ—¶è¡Œæƒ…å¹¶ä»¥æŒ‡æ ‡å¡å½¢å¼å±•ç¤ºã€‚
- å‚æ•°
  - æ— æ˜¾å¼å‚æ•°ï¼›å†…éƒ¨ä»session_stateè¯»å–use_cacheä¸force_refreshã€‚
- è¿”å›å€¼
  - æ— è¿”å›å€¼ï¼›ç›´æ¥æ¸²æŸ“Streamlitç»„ä»¶ã€‚
- ä½¿ç”¨åœºæ™¯
  - åœ¨â€œå¤§ç›˜æŒ‡æ•°â€æ ‡ç­¾é¡µä¸­å±•ç¤ºä¸Šè¯ã€æ·±è¯ã€æ²ªæ·±300ã€ä¸­è¯500ã€åˆ›ä¸šæ¿æŒ‡ç­‰æŒ‡æ•°çš„æœ€æ–°ä»·ã€æ¶¨è·Œå¹…ä¸æ¶¨è·Œé¢ã€‚
- æ•°æ®æ¥æº
  - MarketTools.get_current_indicesï¼›å†…éƒ¨è°ƒç”¨market_data_fetcher.fetch_current_indicesã€‚

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L301-L362)
- [market_data_tools.py](file://market/market_data_tools.py#L232-L249)
- [market_data_fetcher.py](file://market/market_data_fetcher.py#L286-L355)

### æŠ€æœ¯åˆ†æï¼šdisplay_market_technical_analysis
- èŒè´£
  - å±•ç¤ºæŒ‡æ•°Kçº¿å›¾ã€æŠ€æœ¯æŒ‡æ ‡ä¸é£é™©åˆ†æã€‚
- å‚æ•°
  - index_nameï¼šé»˜è®¤â€œä¸Šè¯æŒ‡æ•°â€ï¼Œç”¨äºé€‰æ‹©åˆ†æå¯¹è±¡ã€‚
- è¿”å›å€¼
  - æ— è¿”å›å€¼ï¼›æ¸²æŸ“Kçº¿å›¾ä¸æŠ€æœ¯åˆ†æTabã€‚
- ä½¿ç”¨åœºæ™¯
  - åœ¨â€œæŠ€æœ¯æŒ‡æ ‡â€æ ‡ç­¾é¡µä¸­å±•ç¤ºé€‰å®šæŒ‡æ•°çš„å†å²Kçº¿ã€å‡çº¿ã€MACDã€RSIç­‰æŒ‡æ ‡ï¼Œå¹¶æä¾›é£é™©åˆ†æã€‚
- æ•°æ®æ¥æº
  - MarketTools.get_index_kline_dataä¸get_index_technical_indicatorsï¼›å†…éƒ¨è°ƒç”¨Kçº¿ç®¡ç†å™¨ä¸æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ã€‚

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L537-L597)
- [market_data_tools.py](file://market/market_data_tools.py#L307-L351)
- [market_data_fetcher.py](file://market/market_data_fetcher.py#L568-L607)

### åŸºæœ¬é¢åˆ†æï¼šdisplay_market_fundamentals
- èŒè´£
  - èšåˆå±•ç¤ºä¼°å€¼ã€èµ„é‡‘æµã€èèµ„èåˆ¸ä¸‰ç±»åŸºæœ¬é¢æŒ‡æ ‡ã€‚
- å‚æ•°
  - index_nameï¼šé»˜è®¤â€œæ²ªæ·±300â€ï¼Œç”¨äºé€‰æ‹©ä¼°å€¼å‚è€ƒæŒ‡æ•°ã€‚
- è¿”å›å€¼
  - æ— è¿”å›å€¼ï¼›ä¾æ¬¡è°ƒç”¨ä¼°å€¼ã€èµ„é‡‘æµã€èèµ„èåˆ¸å±•ç¤ºå‡½æ•°ã€‚
- ä½¿ç”¨åœºæ™¯
  - åœ¨â€œå¸‚åœºåŸºæœ¬é¢â€æ ‡ç­¾é¡µä¸­å±•ç¤ºPE/PBã€è‚¡æ¯ç‡ã€M2/M1ã€èèµ„èåˆ¸ä½™é¢ä¸å‘¨å˜åŒ–ç­‰æŒ‡æ ‡ã€‚

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L221-L231)
- [page_market_overview.py](file://ui/components/page_market_overview.py#L221-L231)

#### ä¼°å€¼åˆ†æï¼šdisplay_valuation_analysis
- èŒè´£
  - å±•ç¤ºä¼°å€¼æ°´å¹³ï¼ˆPEã€è‚¡æ¯ç‡ï¼‰ï¼Œå¹¶æä¾›ä¼°å€¼ç­‰çº§è¯´æ˜ã€‚
- å‚æ•°
  - index_nameï¼šé»˜è®¤â€œæ²ªæ·±300â€ï¼›use_cacheï¼šé»˜è®¤Trueã€‚
- è¿”å›å€¼
  - æ— è¿”å›å€¼ï¼›æ¸²æŸ“æŒ‡æ ‡å¡ä¸å±•å¼€æ¡†ã€‚
- ä½¿ç”¨åœºæ™¯
  - ä¾æ®MarketTools.get_index_valuation_dataè¿”å›çš„ä¼°å€¼æ•°æ®ï¼ŒæŒ‰æ˜¯å¦ç›´æ¥ä¼°å€¼æ˜¾ç¤ºä¸åŒè¯´æ˜ã€‚

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L22-L104)
- [market_data_tools.py](file://market/market_data_tools.py#L85-L194)

#### èµ„é‡‘æµå‘ï¼šdisplay_money_flow_analysis
- èŒè´£
  - å±•ç¤ºM2/M1ä½™é¢ä¸åŒæ¯”å¢é•¿ï¼Œæä¾›æµåŠ¨æ€§åˆ†æã€‚
- å‚æ•°
  - use_cacheï¼šé»˜è®¤Trueã€‚
- è¿”å›å€¼
  - æ— è¿”å›å€¼ï¼›æ¸²æŸ“æŒ‡æ ‡å¡ä¸å±•å¼€æ¡†ã€‚
- ä½¿ç”¨åœºæ™¯
  - ä¾æ®MarketTools.get_money_flow_dataè¿”å›çš„å®è§‚è´§å¸ä¾›åº”é‡æ•°æ®è¿›è¡Œå±•ç¤ºã€‚

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L106-L150)
- [market_data_tools.py](file://market/market_data_tools.py#L196-L213)
- [market_data_fetcher.py](file://market/market_data_fetcher.py#L248-L283)

#### èèµ„èåˆ¸ï¼šdisplay_margin_trading_analysis
- èŒè´£
  - å±•ç¤ºèèµ„èåˆ¸ä½™é¢ã€èèµ„ä½™é¢ã€èåˆ¸ä½™é¢ä¸å‘¨å˜åŒ–ç‡ã€‚
- å‚æ•°
  - use_cacheï¼šé»˜è®¤Trueã€‚
- è¿”å›å€¼
  - æ— è¿”å›å€¼ï¼›æ¸²æŸ“æŒ‡æ ‡å¡ä¸ç»Ÿè®¡æ—¶é—´ã€‚
- ä½¿ç”¨åœºæ™¯
  - ä¾æ®MarketTools.get_margin_dataè¿”å›çš„ä¸¤å¸‚æ•°æ®è¿›è¡Œå±•ç¤ºã€‚

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L180-L219)
- [market_data_tools.py](file://market/market_data_tools.py#L214-L231)
- [market_data_fetcher.py](file://market/market_data_fetcher.py#L358-L449)

### å¸‚åœºæƒ…ç»ªï¼šdisplay_market_sentiment
- èŒè´£
  - å±•ç¤ºç»¼åˆå¸‚åœºæƒ…ç»ªåˆ†æï¼Œè°ƒç”¨æ ¼å¼åŒ–å™¨è¾“å‡ºMarkdownã€‚
- å‚æ•°
  - æ— æ˜¾å¼å‚æ•°ï¼›å†…éƒ¨ä»session_stateè¯»å–use_cacheã€‚
- è¿”å›å€¼
  - æ— è¿”å›å€¼ï¼›æ¸²æŸ“Streamlitç»„ä»¶ã€‚
- ä½¿ç”¨åœºæ™¯
  - åœ¨â€œå¸‚åœºæƒ…ç»ªâ€æ ‡ç­¾é¡µä¸­å±•ç¤ºç»¼åˆæƒ…ç»ªè¯„åˆ†ã€æ¶¨è·Œå®¶æ•°ã€æ¶¨åœè·Œåœã€èµ„é‡‘æµå‘ç­‰æŒ‡æ ‡ä¸è§£è¯»ã€‚

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L233-L241)
- [page_market_overview.py](file://ui/components/page_market_overview.py#L162-L178)
- [market_formatters.py](file://market/market_formatters.py#L106-L368)

### å¸‚åœºæ–°é—»ï¼šdisplay_market_news
- èŒè´£
  - æŒ‰é…ç½®å¼€å…³å±•ç¤ºå¸‚åœºæ–°é—»ï¼Œæœ€å¤šæ˜¾ç¤ºå‰10æ¡ã€‚
- å‚æ•°
  - æ— æ˜¾å¼å‚æ•°ï¼›å†…éƒ¨ä»session_stateè¯»å–use_cacheã€‚
- è¿”å›å€¼
  - æ— è¿”å›å€¼ï¼›æ¸²æŸ“æ–°é—»åˆ—è¡¨ä¸æ—¶é—´æˆ³ã€‚
- ä½¿ç”¨åœºæ™¯
  - åœ¨â€œå¸‚åœºèµ„è®¯â€æ ‡ç­¾é¡µä¸­å±•ç¤ºå®è§‚ç»æµæ–°é—»ï¼Œæ”¯æŒæŸ¥çœ‹åŸæ–‡é“¾æ¥ã€‚

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L243-L299)
- [market_data_tools.py](file://market/market_data_tools.py#L250-L271)

### ç»¼åˆæ‘˜è¦ä¸è¯„çº§ï¼šdisplay_market_summary / display_comprehensive_rating
- èŒè´£
  - ç”Ÿæˆç»¼åˆæ‘˜è¦ã€è§¦å‘AIåˆ†æã€æ˜¾ç¤ºç»¼åˆè¯„çº§ä¸å¯¼å‡ºã€‚
- å‚æ•°
  - index_nameï¼šé»˜è®¤â€œä¸Šè¯æŒ‡æ•°â€ã€‚
- è¿”å›å€¼
  - æ— è¿”å›å€¼ï¼›æ¸²æŸ“æ‘˜è¦ã€è¯„çº§ä¸å¯¼å‡ºç»„ä»¶ã€‚
- ä½¿ç”¨åœºæ™¯
  - åœ¨â€œç»¼åˆæ‘˜è¦â€æ ‡ç­¾é¡µä¸­å±•ç¤ºæŠ€æœ¯é¢ã€èµ„é‡‘é¢ã€ä¼°å€¼é¢ã€æµåŠ¨æ€§ä¸æƒ…ç»ªé¢çš„è¦ç‚¹æ‘˜è¦ï¼Œè®¡ç®—ç»¼åˆè¯„çº§å¹¶æä¾›å¯¼å‡ºã€‚

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L599-L625)
- [page_market_overview.py](file://ui/components/page_market_overview.py#L416-L507)

#### ç»¼åˆè¯„çº§è®¡ç®—é€»è¾‘
```mermaid
flowchart TD
Start(["å¼€å§‹"]) --> LoadData["åŠ è½½æŠ€æœ¯é¢/èµ„é‡‘é¢/æƒ…ç»ªé¢æ•°æ®"]
LoadData --> TechScore["æŠ€æœ¯é¢è¯„åˆ†<br/>MAå¤šå¤´æ’åˆ—+1<br/>MACDé‡‘å‰å‘ä¸Š+1"]
LoadData --> FundScore["èµ„é‡‘é¢è¯„åˆ†<br/>èèµ„ä½™é¢>15000+1<br/>12000~15000+0.5"]
LoadData --> EmotionScore["æƒ…ç»ªé¢è¯„åˆ†<br/>æƒ…ç»ªåˆ†>20+1<br/>0~20+0.5<br/>-20~0+0.25"]
TechScore --> Sum["ç´¯è®¡å¾—åˆ†/æ€»æŒ‡æ ‡æ•°"]
FundScore --> Sum
EmotionScore --> Sum
Sum --> Rating{"è¯„åˆ†æ¯”ä¾‹"}
Rating --> |>=0.8| Strong["ğŸŸ¢ å¼ºåŠ¿"]
Rating --> |>=0.6| SlightlyStrong["ğŸ”µ åå¼º"]
Rating --> |>=0.4| Neutral["ğŸŸ¡ ä¸­æ€§"]
Rating --> |>=0.2| SlightlyWeak["ğŸŸ  åå¼±"]
Rating --> |<0.2| Weak["ğŸ”´ å¼±åŠ¿"]
Strong --> End(["ç»“æŸ"])
SlightlyStrong --> End
Neutral --> End
SlightlyWeak --> End
Weak --> End
```

å›¾è¡¨æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L416-L507)

### AIåˆ†æä¸å¯¼å‡ºï¼šhandle_ai_analysis / display_ai_analysis_section / display_market_report_export / write_market_report
- èŒè´£
  - handle_ai_analysisï¼šæ ¹æ®session_stateè§¦å‘AIåˆ†æï¼Œç¼“å­˜ç»“æœã€‚
  - display_ai_analysis_sectionï¼šå±•ç¤ºAIæŠ¥å‘Šä¸æ—¶é—´æˆ³ã€æ˜¯å¦åŒ…å«ç”¨æˆ·è§‚ç‚¹ã€‚
  - display_market_report_exportï¼šè°ƒç”¨é€šç”¨å¯¼å‡ºç»„ä»¶ï¼Œç”Ÿæˆå¹¶ä¸‹è½½æŠ¥å‘Šã€‚
  - write_market_reportï¼šèšåˆç»¼åˆæŠ¥å‘Šä¸AIåˆ†æï¼Œç”ŸæˆPDF/DOCX/Mardown/HTMLã€‚
- å‚æ•°
  - index_nameï¼šé»˜è®¤â€œä¸Šè¯æŒ‡æ•°â€ã€‚
  - use_cacheï¼šé»˜è®¤Trueã€‚
  - user_opinionï¼šç”¨æˆ·è¾“å…¥è§‚ç‚¹ï¼Œé»˜è®¤ç©ºå­—ç¬¦ä¸²ã€‚
- è¿”å›å€¼
  - æ— è¿”å›å€¼ï¼ˆå±•ç¤ºå‡½æ•°ï¼‰ï¼›write_market_reportè¿”å›æ–‡ä»¶å†…å®¹æˆ–é”™è¯¯ä¿¡æ¯ã€‚
- ä½¿ç”¨åœºæ™¯
  - ç”¨æˆ·å‹¾é€‰â€œAIå¤§ç›˜åˆ†æâ€å¹¶åœ¨æ–‡æœ¬åŸŸè¾“å…¥è§‚ç‚¹åï¼Œç‚¹å‡»â€œå¼€å§‹åˆ†æâ€ï¼Œé¡µé¢è§¦å‘AIåˆ†æå¹¶å±•ç¤ºï¼›éšåå¯åœ¨â€œç»¼åˆæ‘˜è¦â€æ ‡ç­¾é¡µå¯¼å‡ºæŠ¥å‘Šã€‚

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L364-L414)
- [page_market_overview.py](file://ui/components/page_market_overview.py#L509-L535)
- [market_data_tools.py](file://market/market_data_tools.py#L379-L495)
- [market_ai_analysis.py](file://market/market_ai_analysis.py#L14-L123)
- [market_report.py](file://market/market_report.py#L13-L87)
- [page_export.py](file://ui/components/page_export.py#L180-L281)

## ä¾èµ–å…³ç³»åˆ†æ
- ç»„ä»¶è€¦åˆ
  - page_market_overviewä¾èµ–MarketToolsè¿›è¡Œæ•°æ®è·å–ä¸AIåˆ†æï¼›MarketToolsè¿›ä¸€æ­¥ä¾èµ–market_data_fetcherä¸market_ai_analysisï¼›æ ¼å¼åŒ–ä¸å¯¼å‡ºç”±market_formattersä¸page_exportæä¾›ã€‚
- å¤–éƒ¨ä¾èµ–
  - akshareã€OpenAIå®¢æˆ·ç«¯ã€æŠ¥å‘Šç”Ÿæˆå·¥å…·ï¼ˆPDF/DOCX/HTML/Markdownï¼‰ã€‚
- é…ç½®ä¾èµ–
  - ui/config.pyä¸­çš„FOCUS_INDICESã€INDEX_SYMBOL_MAPPINGç­‰å½±å“æŒ‡æ•°é€‰æ‹©ä¸æ•°æ®æŸ¥è¯¢ã€‚

```mermaid
graph LR
P["page_market_overview.py"] --> T["market_data_tools.py"]
T --> F["market_data_fetcher.py"]
T --> A["market_ai_analysis.py"]
T --> FM["market_formatters.py"]
P --> EX["page_export.py"]
G["market_report.py"] --> T
G --> FM
P --> CFG["ui/config.py"]
```

å›¾è¡¨æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L627-L758)
- [market_data_tools.py](file://market/market_data_tools.py#L421-L455)
- [market_data_fetcher.py](file://market/market_data_fetcher.py#L286-L355)
- [market_ai_analysis.py](file://market/market_ai_analysis.py#L14-L123)
- [market_formatters.py](file://market/market_formatters.py#L561-L647)
- [market_report.py](file://market/market_report.py#L13-L87)
- [page_export.py](file://ui/components/page_export.py#L180-L281)
- [config.py](file://ui/config.py#L45-L82)

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L627-L758)
- [market_data_tools.py](file://market/market_data_tools.py#L421-L455)
- [market_data_fetcher.py](file://market/market_data_fetcher.py#L286-L355)
- [market_ai_analysis.py](file://market/market_ai_analysis.py#L14-L123)
- [market_formatters.py](file://market/market_formatters.py#L561-L647)
- [market_report.py](file://market/market_report.py#L13-L87)
- [page_export.py](file://ui/components/page_export.py#L180-L281)
- [config.py](file://ui/config.py#L45-L82)

## æ€§èƒ½è€ƒé‡
- ç¼“å­˜ç­–ç•¥
  - MarketToolså¯¹å„ç±»æ•°æ®æä¾›ç¼“å­˜æ ¡éªŒä¸ä¿å­˜ï¼Œæ”¯æŒå¼ºåˆ¶åˆ·æ–°ï¼›é¡µé¢é»˜è®¤ä½¿ç”¨ç¼“å­˜ä»¥æå‡å“åº”é€Ÿåº¦ã€‚
- æ•°æ®è·å–
  - æŒ‡æ•°Kçº¿ä¸æŠ€æœ¯æŒ‡æ ‡é€šè¿‡ç»Ÿä¸€çš„Kçº¿ç®¡ç†å™¨è·å–ï¼Œé¿å…é‡å¤è®¡ç®—ï¼›æƒ…ç»ªä¸èµ„é‡‘æµé‡‡ç”¨å¤šæºå¤‡é€‰æ–¹æ¡ˆï¼Œæé«˜ç¨³å®šæ€§ã€‚
- å¯¼å‡ºæ€§èƒ½
  - å¯¼å‡ºå‰å…ˆç”ŸæˆMarkdownï¼Œå†è½¬ç›®æ ‡æ ¼å¼ï¼›PDFç”Ÿæˆä¾èµ–å¤–éƒ¨åº“ï¼Œå»ºè®®åœ¨å¯ç”¨ç¯å¢ƒä¸‹ä½¿ç”¨ã€‚

[æœ¬èŠ‚ä¸ºé€šç”¨æŒ‡å¯¼ï¼Œæ— éœ€ç‰¹å®šæ–‡ä»¶å¼•ç”¨]

## æ•…éšœæ’æŸ¥æŒ‡å—
- å¸¸è§é—®é¢˜
  - æŒ‡æ•°æ•°æ®ä¸ºç©ºï¼šæ£€æŸ¥ç½‘ç»œä¸akshareæ•°æ®æºï¼Œç¡®è®¤FOCUS_INDICESé…ç½®æ­£ç¡®ã€‚
  - AIåˆ†æå¤±è´¥ï¼šæ£€æŸ¥OpenAIå®¢æˆ·ç«¯é…ç½®ä¸ç½‘ç»œè¿é€šæ€§ï¼›æŸ¥çœ‹é”™è¯¯ä¿¡æ¯å¹¶é‡è¯•ã€‚
  - æ–°é—»åŠŸèƒ½ç¦ç”¨ï¼šè‹¥é…ç½®å…³é—­å¸‚åœºæ–°é—»ï¼Œé¡µé¢å°†ä¸æ˜¾ç¤ºâ€œå¸‚åœºèµ„è®¯â€æ ‡ç­¾é¡µã€‚
- è°ƒè¯•å»ºè®®
  - ä½¿ç”¨åˆ·æ–°æŒ‰é’®æ¸…ç©ºç¼“å­˜å¹¶å¼ºåˆ¶è·å–æœ€æ–°æ•°æ®ã€‚
  - åœ¨â€œè¯¦ç»†ä¿¡æ¯â€å±•å¼€æ¡†ä¸­æŸ¥çœ‹åˆ†ææ—¶é—´ã€åˆ†æå¯¹è±¡ä¸æ•°æ®æºã€‚
  - æŸ¥çœ‹é”™è¯¯è¯¦æƒ…é¢æ¿è·å–å¼‚å¸¸å †æ ˆã€‚

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L729-L740)

## ç»“è®º
å¤§ç›˜åˆ†æç•Œé¢é€šè¿‡æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†ä¸ç»Ÿä¸€çš„æ•°æ®å·¥å…·å±‚ï¼Œå®ç°äº†ä»æŒ‡æ•°è¡Œæƒ…ã€æŠ€æœ¯åˆ†æã€åŸºæœ¬é¢ã€æƒ…ç»ªä¸æ–°é—»åˆ°AIç»¼åˆåˆ†æä¸æŠ¥å‘Šå¯¼å‡ºçš„å®Œæ•´é—­ç¯ã€‚é¡µé¢å…¥å£è´Ÿè´£ç»„ç»‡ä¸è°ƒåº¦ï¼Œæ•°æ®å±‚æä¾›ç¨³å®šå¯é çš„æ•°æ®è·å–ä¸ç¼“å­˜ï¼Œæ ¼å¼åŒ–ä¸å¯¼å‡ºç»„ä»¶ä¿è¯è¾“å‡ºè´¨é‡ä¸å¤šæ ·æ€§ã€‚ç”¨æˆ·å¯é€šè¿‡ç®€å•çš„äº¤äº’å®Œæˆä»æ•°æ®è·å–åˆ°æŠ¥å‘Šå¯¼å‡ºçš„å…¨æµç¨‹ä½“éªŒã€‚

[æœ¬èŠ‚ä¸ºæ€»ç»“æ€§å†…å®¹ï¼Œæ— éœ€ç‰¹å®šæ–‡ä»¶å¼•ç”¨]

## é™„å½•

### APIå®šä¹‰ä¸è°ƒç”¨ç¤ºä¾‹

- é¡µé¢å…¥å£
  - å‡½æ•°ï¼šdisplay_market_overview
  - ç”¨é€”ï¼šç»„ç»‡é¡µé¢å¸ƒå±€ä¸æ ‡ç­¾é¡µï¼Œæ§åˆ¶ç¼“å­˜ä¸AIåˆ†æï¼Œè§¦å‘åˆ†æä¸åˆ·æ–°ã€‚
  - ç¤ºä¾‹ï¼šç”¨æˆ·é€‰æ‹©â€œæ²ªæ·±300â€ï¼Œå‹¾é€‰â€œAIå¤§ç›˜åˆ†æâ€ï¼Œè¾“å…¥è§‚ç‚¹ï¼Œç‚¹å‡»â€œå¼€å§‹åˆ†æâ€ã€‚

- æŒ‡æ•°å±•ç¤º
  - å‡½æ•°ï¼šdisplay_market_indices
  - ç”¨é€”ï¼šå±•ç¤ºå…³æ³¨æŒ‡æ•°çš„å®æ—¶è¡Œæƒ…ã€‚
  - ç¤ºä¾‹ï¼šåœ¨â€œå¤§ç›˜æŒ‡æ•°â€æ ‡ç­¾é¡µä¸­æŸ¥çœ‹ä¸Šè¯ã€æ·±è¯ã€æ²ªæ·±300ç­‰æŒ‡æ•°çš„æœ€æ–°ä»·ä¸æ¶¨è·Œå¹…ã€‚

- æŠ€æœ¯åˆ†æ
  - å‡½æ•°ï¼šdisplay_market_technical_analysis(index_name)
  - ç”¨é€”ï¼šå±•ç¤ºKçº¿å›¾ä¸æŠ€æœ¯æŒ‡æ ‡ï¼Œæä¾›é£é™©åˆ†æã€‚
  - ç¤ºä¾‹ï¼šåˆ†æâ€œä¸Šè¯æŒ‡æ•°â€çš„Kçº¿ä¸MACDã€RSIç­‰æŒ‡æ ‡ã€‚

- åŸºæœ¬é¢åˆ†æ
  - å‡½æ•°ï¼šdisplay_market_fundamentals(index_name)
  - ç”¨é€”ï¼šèšåˆå±•ç¤ºä¼°å€¼ã€èµ„é‡‘æµã€èèµ„èåˆ¸ã€‚
  - ç¤ºä¾‹ï¼šæŸ¥çœ‹æ²ªæ·±300çš„PEã€M2ã€èèµ„èåˆ¸ä½™é¢ç­‰ã€‚

- å¸‚åœºæƒ…ç»ª
  - å‡½æ•°ï¼šdisplay_market_sentiment
  - ç”¨é€”ï¼šå±•ç¤ºç»¼åˆå¸‚åœºæƒ…ç»ªåˆ†æã€‚
  - ç¤ºä¾‹ï¼šæŸ¥çœ‹æ¶¨è·Œå®¶æ•°ã€æ¶¨åœè·Œåœã€èµ„é‡‘æµå‘ä¸æƒ…ç»ªè¯„åˆ†ã€‚

- å¸‚åœºæ–°é—»
  - å‡½æ•°ï¼šdisplay_market_news
  - ç”¨é€”ï¼šæŒ‰é…ç½®å¼€å…³å±•ç¤ºå¸‚åœºæ–°é—»ã€‚
  - ç¤ºä¾‹ï¼šåœ¨â€œå¸‚åœºèµ„è®¯â€æ ‡ç­¾é¡µæŸ¥çœ‹å®è§‚ç»æµæ–°é—»ã€‚

- ç»¼åˆæ‘˜è¦ä¸è¯„çº§
  - å‡½æ•°ï¼šdisplay_market_summary(index_name)
  - ç”¨é€”ï¼šç”Ÿæˆæ‘˜è¦ã€è§¦å‘AIåˆ†æã€æ˜¾ç¤ºç»¼åˆè¯„çº§ä¸å¯¼å‡ºã€‚
  - ç¤ºä¾‹ï¼šåœ¨â€œç»¼åˆæ‘˜è¦â€æ ‡ç­¾é¡µæŸ¥çœ‹æŠ€æœ¯é¢ã€èµ„é‡‘é¢ã€ä¼°å€¼é¢ã€æµåŠ¨æ€§ä¸æƒ…ç»ªé¢æ‘˜è¦ã€‚

- AIåˆ†æä¸å¯¼å‡º
  - å‡½æ•°ï¼šhandle_ai_analysis(index_name, use_cache)
  - ç”¨é€”ï¼šæ ¹æ®session_stateè§¦å‘AIåˆ†æå¹¶ç¼“å­˜ç»“æœã€‚
  - å‡½æ•°ï¼šdisplay_ai_analysis_section(index_name)
  - ç”¨é€”ï¼šå±•ç¤ºAIæŠ¥å‘Šä¸æ—¶é—´æˆ³ã€æ˜¯å¦åŒ…å«ç”¨æˆ·è§‚ç‚¹ã€‚
  - å‡½æ•°ï¼šdisplay_market_report_export(index_name)
  - ç”¨é€”ï¼šè°ƒç”¨é€šç”¨å¯¼å‡ºç»„ä»¶ç”Ÿæˆå¹¶ä¸‹è½½æŠ¥å‘Šã€‚
  - å‡½æ•°ï¼šwrite_market_report(index_name, format_type, has_ai_analysis, user_opinion)
  - ç”¨é€”ï¼šèšåˆç»¼åˆæŠ¥å‘Šä¸AIåˆ†æï¼Œç”ŸæˆPDF/DOCX/Mardown/HTMLã€‚

ç« èŠ‚æ¥æº
- [page_market_overview.py](file://ui/components/page_market_overview.py#L221-L758)
- [market_data_tools.py](file://market/market_data_tools.py#L379-L495)
- [market_ai_analysis.py](file://market/market_ai_analysis.py#L14-L123)
- [market_report.py](file://market/market_report.py#L13-L87)
- [page_export.py](file://ui/components/page_export.py#L180-L281)

### æµ‹è¯•å‚è€ƒ
- å•å…ƒæµ‹è¯•è¦†ç›–äº†é¡µé¢æ¸²æŸ“ã€æŒ‡æ•°é€‰æ‹©ã€ç¼“å­˜æ§åˆ¶ã€æŠ€æœ¯åˆ†æã€AIåˆ†æé›†æˆç­‰åœºæ™¯ï¼Œå¯ä½œä¸ºè¡Œä¸ºå‚è€ƒä¸å›å½’ä¿éšœã€‚

ç« èŠ‚æ¥æº
- [test_page_market_overview.py](file://tests/unit/ui/test_page_market_overview.py#L1-L399)